<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Game Boy Calculator</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap'); /* Import a pixel font */

        body {
            /* Use a pixel font for the main interface elements */
            font-family: 'Press Start 2P', cursive;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0; /* Keep background simple */
             /* Disable anti-aliasing for sharper pixels */
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        .calculator {
            background-color: #59a7b8; /* Pastel blue body */
            border: 4px solid #444; /* Thicker, darker border */
            /* Remove border-radius for sharp corners */
            border-radius: 8px; /* Slight radius for Game Boy feel, less than before */
            padding: 15px; /* Slightly reduce padding */
            width: 340px; /* Adjust width slightly if needed */
            /* Hard shadow effect using box-shadow with no blur */
            box-shadow: 4px 4px 0px #3b7b8a; /* Darker shade of body blue */
        }

        .screen-area {
            background-color: #4b72a0; /* Darker pastel blue screen bezel */
            border: 3px solid #444; /* Dark border */
            border-radius: 4px; /* Minimal radius */
            padding: 8px;
            margin-bottom: 15px;
            box-shadow: inset 2px 2px 0px #3a5a80; /* Inner shadow */
        }

        .screen-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            color: #d1e4f0; /* Lighter color for header text */
            font-size: 8px; /* Smaller pixel font size */
            letter-spacing: 1px; /* Space out letters */
            padding: 0 2px;
        }

        .screen-label {
             /* Already set by body */
        }

        .model-number {
             /* Already set by body */
        }

        .screen {
            background-color: #9badcc; /* Slightly desaturated blue for display */
            border: 2px solid #444;
            border-radius: 2px; /* Very sharp corners */
            height: 60px;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            padding: 0 10px;
            font-family: 'Press Start 2P', cursive; /* Ensure screen uses pixel font */
            font-size: 20px; /* Adjust size for pixel font readability */
            overflow: hidden;
            color: #222; /* Dark color for screen text */
            box-shadow: inset 1px 1px 0px #798bb4; /* Subtle inner shadow */
            letter-spacing: 2px; /* Space out digits */
        }

        .controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 0 5px; /* Add slight padding */
        }

        .dpad {
            display: grid; /* Use grid for easier pixel alignment */
            grid-template-columns: repeat(3, 40px);
            grid-template-rows: repeat(3, 40px);
            gap: 2px; /* Small gap between buttons */
            width: auto; /* Let grid define width */
            /* align-items: center; no longer needed with grid */
        }

        /* Positioning D-pad buttons within the grid */
        .dpad-btn-up { grid-column: 2; grid-row: 1; }
        .dpad-btn-left { grid-column: 1; grid-row: 2; }
        .dpad-btn-right { grid-column: 3; grid-row: 2; }
        .dpad-btn-down { grid-column: 2; grid-row: 3; }
        /* Placeholder for center - can be styled or left empty */
        /* .dpad-center { grid-column: 2; grid-row: 2; background: #444; border-radius: 50%;} */


        .dpad-btn {
            width: 40px; /* Fixed size */
            height: 40px; /* Fixed size */
            background-color: #4a4a4a; /* Darker grey buttons */
            border: 2px solid #222; /* Very dark border */
            border-radius: 3px; /* Slightly rounded square */
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            color: #d1c4e9; /* Pastel purple accents (arrows) */
            font-family: sans-serif; /* Use simple symbols */
            font-size: 20px;
            font-weight: bold;
             box-shadow: 2px 2px 0px #2a2a2a; /* Hard shadow */
        }

        .action-buttons {
            display: flex;
            align-items: center; /* Align vertically */
            padding-top: 20px; /* Align roughly with dpad */
        }

        .action-btn {
            width: 55px; /* Slightly larger */
            height: 55px;
            border-radius: 50%; /* Keep original Game Boy round buttons */
            border: 3px solid #444;
            margin: 0 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Press Start 2P', cursive; /* Pixel font */
            font-size: 14px; /* Adjust size */
            cursor: pointer;
             box-shadow: 2px 2px 0px #333; /* Hard shadow */
             color: #333; /* Dark text on buttons */
             padding-bottom: 4px; /* Adjust text position */
        }

        .clear-btn {
            background-color: #ff8a80; /* Brighter Pastel red */
        }

        .equals-btn {
            background-color: #80cbc4; /* Tealish Pastel blue */
        }


        .keypad {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px; /* Slightly smaller gap */
        }

        .keypad-btn {
            height: 45px; /* Slightly shorter */
            border: 2px solid #444;
            border-radius: 3px; /* Slightly rounded square */
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Press Start 2P', cursive; /* Pixel font */
            font-size: 14px;
            cursor: pointer;
            box-shadow: 2px 2px 0px #333; /* Hard shadow */
            color: #333; /* Dark text */
            padding-bottom: 3px; /* Adjust text position */
        }

        .number-btn {
            background-color: #bcaae0; /* Adjusted Pastel purple */
        }

        .operator-btn {
            background-color: #f4a8c1; /* Adjusted Pastel pink */
        }

        .zero-btn {
            grid-column: span 2;
        }

        .bottom-buttons {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 30px; /* Space between buttons */
        }

        .bottom-btn {
            width: 70px; /* Wider */
            height: 18px;
            background-color: #5a5a5a; /* Dark grey */
            border: 2px solid #222;
            border-radius: 10px; /* Keep these pill-shaped */
            /* Remove rotation for blockier look */
            /* transform: rotate(0); */
             box-shadow: 2px 2px 0px #2a2a2a; /* Hard shadow */
        }

        /* Button press effects - translate down/right and remove shadow */
        .dpad-btn:active, .action-btn:active, .keypad-btn:active, .bottom-btn:active {
            transform: translate(2px, 2px);
            box-shadow: none; /* Remove shadow when pressed */
        }
    </style>
</head>
<body>
    <div class="calculator">
        <!-- Screen area -->
        <div class="screen-area">
            <div class="screen-header">
                <span class="screen-label">CALC</span> <!-- Shorter Label -->
                <span class="model-number">DMG-01</span>
            </div>
            <div class="screen" id="display">0</div>
        </div>

        <!-- Controls area -->
        <div class="controls">
            <!-- D-pad (decorative but styled) -->
            <div class="dpad">
                 <!-- Using grid layout classes -->
                <div class="dpad-btn dpad-btn-up">▲</div>
                <div class="dpad-btn dpad-btn-left">◀</div>
                <!-- <div class="dpad-center"></div> Optional center piece -->
                <div class="dpad-btn dpad-btn-right">▶</div>
                <div class="dpad-btn dpad-btn-down">▼</div>
            </div>

            <!-- A/B buttons (functional) -->
            <div class="action-buttons">
                 <!-- Text adjusted for pixel font -->
                <div class="action-btn clear-btn" id="clear">CLR</div>
                <div class="action-btn equals-btn" id="equals">=</div>
            </div>
        </div>

        <!-- Keypad -->
        <div class="keypad">
            <div class="keypad-btn number-btn" data-value="7">7</div>
            <div class="keypad-btn number-btn" data-value="8">8</div>
            <div class="keypad-btn number-btn" data-value="9">9</div>
            <div class="keypad-btn operator-btn" data-value="/">/</div> <!-- Simpler symbol -->

            <div class="keypad-btn number-btn" data-value="4">4</div>
            <div class="keypad-btn number-btn" data-value="5">5</div>
            <div class="keypad-btn number-btn" data-value="6">6</div>
            <div class="keypad-btn operator-btn" data-value="*">*</div> <!-- Simpler symbol -->

            <div class="keypad-btn number-btn" data-value="1">1</div>
            <div class="keypad-btn number-btn" data-value="2">2</div>
            <div class="keypad-btn number-btn" data-value="3">3</div>
            <div class="keypad-btn operator-btn" data-value="-">-</div> <!-- Simpler symbol -->

            <div class="keypad-btn number-btn zero-btn" data-value="0">0</div>
            <div class="keypad-btn number-btn" data-value=".">.</div>
            <div class="keypad-btn operator-btn" data-value="+">+</div>
        </div>

        <!-- Start/Select buttons (decorative) -->
        <div class="bottom-buttons">
            <div class="bottom-btn select-btn"></div> <!-- Removed rotation classes -->
            <div class="bottom-btn start-btn"></div>
        </div>
    </div>

    <script>
        // JavaScript remains the same as it handles logic, not presentation
        document.addEventListener('DOMContentLoaded', function() {
            const display = document.getElementById('display');
            const clearBtn = document.getElementById('clear');
            const equalsBtn = document.getElementById('equals');
            const numberBtns = document.querySelectorAll('.number-btn');
            const operatorBtns = document.querySelectorAll('.operator-btn');

            let currentInput = '0';
            let firstOperand = null;
            let operator = null;
            let waitingForSecondOperand = false;
            const maxDisplayLength = 9; // Limit for pixel screen

            // Update display
            function updateDisplay() {
                let displayValue = currentInput;
                // Handle potential exponential notation from calculations
                if (displayValue.includes('e')) {
                   displayValue = parseFloat(displayValue).toPrecision(maxDisplayLength - 2);
                }
                // Truncate if too long
                 if (displayValue.length > maxDisplayLength) {
                    // Try to keep significant digits if it's a result
                    if (waitingForSecondOperand && firstOperand !== null) {
                         displayValue = parseFloat(displayValue).toPrecision(maxDisplayLength);
                         // Final check after precision formatting
                         if (displayValue.length > maxDisplayLength) {
                           displayValue = displayValue.substring(0, maxDisplayLength);
                         }
                    } else {
                        // If typing, just cut off
                        displayValue = displayValue.substring(0, maxDisplayLength);
                    }
                 }
                 // Update internal state only with valid numbers or '0'
                 if (!isNaN(parseFloat(displayValue)) || displayValue === '0' || displayValue === '0.'){
                    currentInput = displayValue;
                 } else if (currentInput.length > maxDisplayLength) {
                     // If truncation resulted in NaN prevent it from breaking things
                     currentInput = currentInput.substring(0, maxDisplayLength);
                     displayValue = currentInput;
                 }


                display.textContent = displayValue;
            }

            // Handle digit input
            function inputDigit(digit) {
                 if (currentInput.length >= maxDisplayLength && !waitingForSecondOperand) return; // Prevent overflow

                if (waitingForSecondOperand) {
                    currentInput = digit;
                    waitingForSecondOperand = false;
                } else {
                    // Prevent leading zeros like 00, 05 etc.
                    if (currentInput === '0') {
                        currentInput = digit;
                    } else {
                         currentInput += digit;
                    }
                }
                updateDisplay();
            }

            // Handle decimal point
            function inputDecimal() {
                if (currentInput.length >= maxDisplayLength && !waitingForSecondOperand) return; // Prevent overflow

                if (waitingForSecondOperand) {
                    currentInput = '0.';
                    waitingForSecondOperand = false;
                    updateDisplay();
                    return;
                }

                if (!currentInput.includes('.')) {
                    currentInput += '.';
                    updateDisplay();
                }
            }

            // Handle operators
            function handleOperator(nextOperator) {
                const inputValue = parseFloat(currentInput);

                 // Allow changing operator if waiting for second operand
                 if (operator && waitingForSecondOperand) {
                     operator = nextOperator;
                     return;
                 }

                if (firstOperand === null && !isNaN(inputValue)) {
                    firstOperand = inputValue;
                } else if (operator) {
                    const result = performCalculation();
                     if (result === 'Error') {
                         currentInput = 'Error';
                         resetCalculatorStateOnError();
                     } else {
                         currentInput = String(result);
                         firstOperand = result; // Chain calculation
                     }
                    updateDisplay(); // Show intermediate result
                 } else {
                     // Handle case where operator is pressed after equals or clear without new number
                     firstOperand = inputValue;
                 }

                waitingForSecondOperand = true;
                operator = nextOperator;
            }

             // Perform calculation
             function performCalculation() {
                 if (operator === null || waitingForSecondOperand) return parseFloat(currentInput); // Should not calculate if waiting or no op

                 const secondOperand = parseFloat(currentInput);

                 if (isNaN(firstOperand) || isNaN(secondOperand)) return 'Error'; // Check for invalid numbers

                 let result;

                 switch (operator) {
                     case '+':
                         result = firstOperand + secondOperand;
                         break;
                     case '-':
                         result = firstOperand - secondOperand;
                         break;
                     case '*':
                         result = firstOperand * secondOperand;
                         break;
                     case '/':
                         if (secondOperand === 0) {
                             return 'Error'; // Division by zero
                         }
                         result = firstOperand / secondOperand;
                         break;
                     default:
                         return secondOperand; // Should not happen with valid operator
                 }

                 // Check for results too large or small for display
                 if (!isFinite(result)) {
                     return 'Error';
                 }

                 // Basic rounding to avoid long decimals - adjust precision as needed
                 // Use Number() to potentially remove trailing zeros after toFixed
                 // return Number(result.toFixed(6));
                 // Let's use precision to fit screen better
                 return parseFloat(result.toPrecision(maxDisplayLength));

             }

            // Clear calculator
            function resetCalculator() {
                currentInput = '0';
                firstOperand = null;
                operator = null;
                waitingForSecondOperand = false;
                updateDisplay();
            }

             // Reset state after error display
             function resetCalculatorStateOnError() {
                 firstOperand = null;
                 operator = null;
                 waitingForSecondOperand = false;
                 // Keep 'Error' on display until next input or clear
             }

            // Event listeners for buttons
            numberBtns.forEach(button => {
                button.addEventListener('click', () => {
                    if (display.textContent === 'Error') {
                        resetCalculator(); // Clear error on next number input
                    }
                    const value = button.getAttribute('data-value');
                    if (value === '.') {
                        inputDecimal();
                    } else {
                        inputDigit(value);
                    }
                });
            });

            operatorBtns.forEach(button => {
                button.addEventListener('click', () => {
                     if (display.textContent === 'Error') return; // Don't allow ops after error
                    handleOperator(button.getAttribute('data-value'));
                });
            });

            equalsBtn.addEventListener('click', () => {
                if (display.textContent === 'Error' || !operator || waitingForSecondOperand) return; // Don't calculate after error or without full expression

                const result = performCalculation();
                 if (result === 'Error') {
                     currentInput = 'Error';
                     resetCalculatorStateOnError();
                 } else {
                     currentInput = String(result);
                     // After equals, the result becomes the potential first operand for a new calculation
                     firstOperand = result; // Store result
                     operator = null; // Ready for new calculation sequence
                     waitingForSecondOperand = true; // Allow starting new number or op immediately
                 }
                updateDisplay();
                // After calculation, effectively wait for the next number or operator
                // Setting waitingForSecondOperand = true allows overwriting the result display with new input
            });


             clearBtn.addEventListener('click', () => {
                 resetCalculator();
                 // If CLR is hit after an error, ensure display is cleared too
                 if (display.textContent === 'Error') {
                     display.textContent = '0';
                 }
             });

            // Keyboard support
            document.addEventListener('keydown', event => {
                let handled = false;
                 const key = event.key;

                 // Handle error state
                 if (display.textContent === 'Error') {
                     if (key === 'Escape' || key.toLowerCase() === 'c') {
                         resetCalculator();
                         handled = true;
                     } else if (/^\d$/.test(key) || key === '.') {
                          resetCalculator(); // Clear error before processing new input
                          // Allow event processing to continue below
                     } else {
                         handled = true; // Ignore other keys after error
                     }
                      if (handled) {
                          event.preventDefault();
                          return;
                      }
                 }


                // Numbers 0-9
                if (/^\d$/.test(key)) {
                    inputDigit(key);
                    handled = true;
                }
                // Decimal point
                else if (key === '.') {
                    inputDecimal();
                    handled = true;
                }
                // Operators
                else if (/^[+\-*/]$/.test(key)) {
                    handleOperator(key);
                    handled = true;
                }
                // Enter/= for equals
                else if (key === 'Enter' || key === '=') {
                    // Simulate click to use the existing robust logic
                    equalsBtn.click();
                    handled = true;
                }
                // Escape/c for clear
                else if (key === 'Escape' || key.toLowerCase() === 'c') {
                    // Simulate click
                     clearBtn.click();
                    handled = true;
                }
                 // Backspace for correction (optional)
                 else if (key === 'Backspace') {
                     if (!waitingForSecondOperand && currentInput !== '0' && currentInput !== 'Error') {
                         currentInput = currentInput.slice(0, -1);
                         if (currentInput === '') {
                             currentInput = '0';
                         }
                         updateDisplay();
                         handled = true;
                     }
                 }

                if (handled) {
                    event.preventDefault(); // Prevent default browser actions if we handled the key
                     // Trigger :active style for keyboard input
                     const button = findButtonForKey(key);
                     if (button) {
                         button.classList.add('active-key');
                         setTimeout(() => button.classList.remove('active-key'), 100); // Visual feedback
                     }
                 }
             });

             // Helper to find button associated with key for visual feedback
             function findButtonForKey(key) {
                 if (/^\d|\./.test(key)) return document.querySelector(`.keypad-btn[data-value="${key}"]`);
                 if (/^[+\-*/]$/.test(key)) return document.querySelector(`.keypad-btn[data-value="${key}"]`);
                 if (key === 'Enter' || key === '=') return equalsBtn;
                 if (key === 'Escape' || key.toLowerCase() === 'c') return clearBtn;
                 return null;
             }
            // Add CSS for keyboard active state feedback
             const styleSheet = document.createElement("style");
             styleSheet.type = "text/css";
             styleSheet.innerText = `.active-key { transform: translate(2px, 2px); box-shadow: none !important; }`; // Mimic :active style
             document.head.appendChild(styleSheet);


            // Initial display update
            updateDisplay();
        });
    </script>
</body>
</html>